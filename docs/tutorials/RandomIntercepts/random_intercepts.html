<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="W. Joel Schneider">
<meta name="dcterms.date" content="2025-01-27">
<meta name="description" content="W. Joel Schneider is a professor at Temple University.">

<title>W. Joel Schneider</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-8b7f06565fe756b746b8fc89eeb347f4.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="W. Joel Schneider">
<meta property="og:description" content="Regression in which each group has its own intercept">
<meta property="og:image" content="https://wjschne.github.io/tutorials/RandomIntercepts/random_intercepts_files/figure-html/fig-model0-1.png">
<meta property="og:site_name" content="W. Joel Schneider">
<meta property="og:image:height" content="1536">
<meta property="og:image:width" content="1536">
</head>

<body class="floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">W. Joel Schneider</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">R Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../assessingpsyche.html"> 
<span class="menu-text">Assessment Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../vita.html"> 
<span class="menu-text">Vita</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials.html"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="mailto:schneider@temple.edu" rel="noreferrer noopener" target="_blank"> <i class="bi bi-envelope" role="img" aria-label="Email">
</i> 
<span class="menu-text">Email</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/wjschne" rel="noreferrer noopener" target="_blank"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text">GitHub</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Random Intercept Models in R</h1>
            <p class="subtitle lead">Advanced Data Analysis (EDUC 8825)</p>
                  <div>
        <div class="description">
          Regression in which each group has its own intercept
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>W. Joel Schneider </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 27, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fixed-vs.-random-effects" id="toc-fixed-vs.-random-effects" class="nav-link active" data-scroll-target="#fixed-vs.-random-effects">Fixed vs.&nbsp;Random Effects</a></li>
  <li><a href="#random-variables-at-multiple-levels-of-analysis" id="toc-random-variables-at-multiple-levels-of-analysis" class="nav-link" data-scroll-target="#random-variables-at-multiple-levels-of-analysis">Random variables at multiple levels of analysis</a></li>
  <li><a href="#a-reading-comprehension-intervention-study" id="toc-a-reading-comprehension-intervention-study" class="nav-link" data-scroll-target="#a-reading-comprehension-intervention-study">A Reading Comprehension Intervention Study</a></li>
  <li><a href="#install-and-load-packages" id="toc-install-and-load-packages" class="nav-link" data-scroll-target="#install-and-load-packages">Install and Load packages</a>
  <ul class="collapse">
  <li><a href="#lme4" id="toc-lme4" class="nav-link" data-scroll-target="#lme4">lme4</a></li>
  <li><a href="#easystats" id="toc-easystats" class="nav-link" data-scroll-target="#easystats">Easystats</a></li>
  </ul></li>
  <li><a href="#import-data-.csv-data" id="toc-import-data-.csv-data" class="nav-link" data-scroll-target="#import-data-.csv-data">Import data .csv data</a></li>
  <li><a href="#model-0-random-intercepts" id="toc-model-0-random-intercepts" class="nav-link" data-scroll-target="#model-0-random-intercepts">Model 0: Random Intercepts</a>
  <ul class="collapse">
  <li><a href="#lme4-formula-syntax" id="toc-lme4-formula-syntax" class="nav-link" data-scroll-target="#lme4-formula-syntax">lme4 Formula Syntax</a></li>
  <li><a href="#model-fit-object" id="toc-model-fit-object" class="nav-link" data-scroll-target="#model-fit-object">Model Fit Object</a></li>
  <li><a href="#checking-model-assumptions" id="toc-checking-model-assumptions" class="nav-link" data-scroll-target="#checking-model-assumptions">Checking Model Assumptions</a>
  <ul class="collapse">
  <li><a href="#normality-assumptions" id="toc-normality-assumptions" class="nav-link" data-scroll-target="#normality-assumptions">Normality Assumptions</a></li>
  <li><a href="#check-for-auto-correlation" id="toc-check-for-auto-correlation" class="nav-link" data-scroll-target="#check-for-auto-correlation">Check for auto-correlation</a></li>
  <li><a href="#check-for-non-constant-error-variance-heteroscedasticity" id="toc-check-for-non-constant-error-variance-heteroscedasticity" class="nav-link" data-scroll-target="#check-for-non-constant-error-variance-heteroscedasticity">Check for non-constant error variance (heteroscedasticity)</a></li>
  <li><a href="#check-for-outliers" id="toc-check-for-outliers" class="nav-link" data-scroll-target="#check-for-outliers">Check for outliers</a></li>
  </ul></li>
  <li><a href="#model-summary" id="toc-model-summary" class="nav-link" data-scroll-target="#model-summary">Model Summary</a></li>
  <li><a href="#model-statistics" id="toc-model-statistics" class="nav-link" data-scroll-target="#model-statistics">Model Statistics</a></li>
  <li><a href="#intraclass-correlation-coefficient-icc" id="toc-intraclass-correlation-coefficient-icc" class="nav-link" data-scroll-target="#intraclass-correlation-coefficient-icc">Intraclass Correlation Coefficient (ICC)</a></li>
  <li><a href="#variance-explained-r2" id="toc-variance-explained-r2" class="nav-link" data-scroll-target="#variance-explained-r2">Variance Explained (<em>R<sup>2</sup></em>)</a></li>
  <li><a href="#fixed-and-random-coefficients" id="toc-fixed-and-random-coefficients" class="nav-link" data-scroll-target="#fixed-and-random-coefficients">Fixed and Random Coefficients</a></li>
  <li><a href="#basic-plot" id="toc-basic-plot" class="nav-link" data-scroll-target="#basic-plot">Basic Plot</a></li>
  </ul></li>
  <li><a href="#model-1-effect-of-treatment" id="toc-model-1-effect-of-treatment" class="nav-link" data-scroll-target="#model-1-effect-of-treatment">Model 1: Effect of Treatment</a>
  <ul class="collapse">
  <li><a href="#fit-object" id="toc-fit-object" class="nav-link" data-scroll-target="#fit-object">Fit object</a></li>
  <li><a href="#assumption-checks" id="toc-assumption-checks" class="nav-link" data-scroll-target="#assumption-checks">Assumption Checks</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#plot-model" id="toc-plot-model" class="nav-link" data-scroll-target="#plot-model">Plot Model</a></li>
  <li><a href="#fixed-and-random-coefficients-1" id="toc-fixed-and-random-coefficients-1" class="nav-link" data-scroll-target="#fixed-and-random-coefficients-1">Fixed and Random Coefficients</a></li>
  <li><a href="#intraclass-correlation-coefficient" id="toc-intraclass-correlation-coefficient" class="nav-link" data-scroll-target="#intraclass-correlation-coefficient">Intraclass Correlation Coefficient</a></li>
  <li><a href="#variance-explained-r2-1" id="toc-variance-explained-r2-1" class="nav-link" data-scroll-target="#variance-explained-r2-1">Variance Explained (<em>R<sup>2</sup></em>)</a></li>
  <li><a href="#compare-models" id="toc-compare-models" class="nav-link" data-scroll-target="#compare-models">Compare Models</a></li>
  <li><a href="#reduction-in-random-variable-variance" id="toc-reduction-in-random-variable-variance" class="nav-link" data-scroll-target="#reduction-in-random-variable-variance">Reduction in random variable variance</a></li>
  <li><a href="#not-so-basic-plot" id="toc-not-so-basic-plot" class="nav-link" data-scroll-target="#not-so-basic-plot">Not-So Basic Plot</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="fixed-vs.-random-effects" class="level1">
<h1>Fixed vs.&nbsp;Random Effects</h1>
<p>In a one-way ANOVA, there is a fixed variable and a random variable. Usually, our focus is on the fixed variable—so much so that we might not realize that the random variable is a variable at all.</p>
<p>A <em>fixed effect</em> is used when the comparisons between groups of scores are meaningful. There is a small, defined number of groups, and all of them are sampled. A <em>random effect</em> is one where the number of groups is open-ended, and the differences between specific groups are not of theoretical interest.</p>
<p>For example, suppose that we compare an outcome variable collected from children who have been given no treatment, a short intervention, and a long-lasting intervention.</p>
<p><span class="math display">
Outcome_i=Treatment_i+e_i
</span></p>
<ul>
<li>The fixed effect is the <em>treatment</em> variable with 3 group means for the control group, the short intervention group, and the long intervention group.</li>
<li>The random effect is the difference of each <em>child</em> <span class="math inline">(e)</span>. It is a random effect because there is an open-ended number of children who could have been in our study, and we have no theoretical interest in comparing specific children with other specific children.</li>
</ul>
<p>The one-way ANOVA comparing the three groups of children will reveal something about the group mean differences on the outcome variable, but nothing substantive about individual children.</p>
</section>
<section id="random-variables-at-multiple-levels-of-analysis" class="level1">
<h1>Random variables at multiple levels of analysis</h1>
<p>In multilevel modeling (and in random-effects ANOVA), we can specify more than one random variable. For example, in educational research, we collect data from many classrooms. Thus, both <em>student</em> and <em>classroom</em> are random variables, because we have no theoretical interest in the differences among specific students or specific classrooms. We cannot collect data from every student or every classroom, so we collect data from a representative number of students and classrooms.</p>
<p>A variable is said to be <strong>nested</strong> if every unit belongs to exactly one group. In elementary school, each student belongs to one class only. Thus, the <em>student</em> random variable is nested in the <em>classroom</em> random variable.</p>
<p>Because there are many students in each classroom, the <em>student</em> variable is said to be a “level-1 random variable,” and <em>classroom</em> is said to be a “level-2 random variable.”</p>
<p>In middle school and beyond, student and classroom are not nested because each student belongs to multiple classes. In such data sets, <em>student</em> and <em>classroom</em> are said to be <strong>crossed</strong> random variables.</p>
<p>In longitudinal studies, we have multiple scores per person, one for each time period. Thus the two random variables are <em>time period</em> and <em>person</em>, and <em>time period</em> is nested in <em>person</em>. In this case, the <em>time period</em> is the level-1 random variable and <em>person</em> is the level-2 variable. If these people were arranged in different psychotherapy groups, then <em>therapy group</em> would be a level-3 random variable.</p>
<p>There is no theoretical limit to the number levels your analysis can have, but practical and computational difficulties often arise as the number of levels increases.</p>
</section>
<section id="a-reading-comprehension-intervention-study" class="level1">
<h1>A Reading Comprehension Intervention Study</h1>
<p>Suppose we study the effects of an intervention on second-grade students’ performance on reading comprehension tests. Some students receive the intervention and some are given treatment-as-usual. We use a <a href="https://www.wikiwand.com/en/Cluster_randomised_controlled_trial"><em>cluster-randomized controlled trial</em></a>, meaning that instead of assigning students to intervention groups individually, we assign whole <em>clusters</em> at a time. In the case, the clusters are classrooms. Thus, some classrooms are in the intervention condition, and some are in the control condition.</p>
</section>
<section id="install-and-load-packages" class="level1">
<h1>Install and Load packages</h1>
<section id="lme4" class="level2">
<h2 class="anchored" data-anchor-id="lme4">lme4</h2>
<p>The primary package for multilevel modeling we will use in this class is <a href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf">lme4</a>.</p>
</section>
<section id="easystats" class="level2">
<h2 class="anchored" data-anchor-id="easystats">Easystats</h2>
<p>The <a href="https://easystats.github.io/easystats/">easystats</a> package, like the tidyverse package, loads a family of packages that can make many aspects of analysis much, much easier than they used to be. You should know that the packages are still very much in development.</p>
<ul>
<li><a href="https://easystats.github.io/parameters/"><img src="https://easystats.github.io/parameters/logo.png" class="img-fluid" width="100" alt="parameters"></a> <a href="https://easystats.github.io/parameters/">parameters</a> gets information about model parameters.</li>
<li><a href="https://github.com/easystats/performance"><img src="https://easystats.github.io/performance/logo.png" class="img-fluid" width="100" alt="performance"></a> <a href="https://github.com/easystats/performance">performance</a> helps you evaluate the performance of your models.</li>
<li><a href="https://easystats.github.io/modelbased/"><img src="https://easystats.github.io/modelbased/logo.png" class="img-fluid" width="100" alt="modelbased"></a> <a href="https://github.com/easystats/modelbased">modelbased</a> computes marginal means and model-based predictions.</li>
<li><a href="https://easystats.github.io/insight/"><img src="https://easystats.github.io/insight/logo.png" class="img-fluid" width="100" alt="insight"></a> <a href="https://github.com/easystats/insight">insight</a> extracts fundamental information about your model.</li>
<li><a href="https://easystats.github.io/effectsize/"><img src="https://easystats.github.io/effectsize/logo.png" class="img-fluid" width="100" alt="effectsize"></a> <a href="https://easystats.github.io/effectsize/">effectsize</a> computes model effect sizes.</li>
<li><a href="https://easystats.github.io/correlation/"><img src="https://easystats.github.io/correlation/logo.png" class="img-fluid" width="100" alt="correlation"></a> <a href="https://easystats.github.io/correlation/">correlation</a> makes working with correlations easier.</li>
<li><a href="https://easystats.github.io/datawizard/"><img src="https://easystats.github.io/datawizard/logo.png" class="img-fluid" width="100" alt="datawizard"></a> <a href="https://easystats.github.io/datawizard/">datawizard</a> makes transforming your data easier.</li>
<li><a href="https://easystats.github.io/see/"><img src="https://easystats.github.io/see/logo.png" class="img-fluid" width="100" alt="see"></a> <a href="https://easystats.github.io/see/">see</a> makes publication-ready data visualizations.</li>
<li><a href="https://easystats.github.io/report/"><img src="https://easystats.github.io/report/logo.png" class="img-fluid" width="100" alt="report"></a> <a href="https://easystats.github.io/report/">report</a> automates model interpretation.</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install packages, if needed.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"tidyverse"</span>)) <span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"lme4"</span>)) <span class="fu">install.packages</span>(<span class="st">"lme4"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"easystats"</span>)) <span class="fu">install.packages</span>(<span class="st">"easystats"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"marginaleffects"</span>)) <span class="fu">install.packages</span>(<span class="st">"marginaleffects"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4) <span class="co"># Multilevel modeling</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># General data management and plotting</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(easystats) <span class="co"># General modeling enhancements</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marginaleffects) <span class="co"># Predicted values </span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="import-data-.csv-data" class="level1">
<h1>Import data .csv data</h1>
<p>Here I import the data frame, and I specify the nature of the variables.</p>
<p>I can just import the data with no fuss like so:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://github.com/wjschne/EDUC5529/raw/master/random_intercept.csv"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The .csv format (comma separated values) is widely used because it is straightforward and non-proprietary. Every statistics and spreadsheet program can open it. It will never die. You can count on it.</p>
<p>However, unlike SPSS’s .sav data format, the .csv format has very little <em>metadata</em> (data about data). By convention, a .csv file’s only metadata is that the first row contains the variable names. The rest of the file is just raw text separated by commas. Should a particular column be considered numeric? text? dates? If it is text, should the text be ordered in any way (e.g., <em>strongly disagree</em>, <em>disagree</em>, <em>agree</em>, <em>strongly agree</em>)?</p>
<p>The <code>readr::read_csv</code> function will make sensible guesses about each variable’s format, but it cannot possibly anticipate everything. We might need to tell it what is going on with each variable.</p>
<p>If we import a file with defaults, we can ask readr which guesses it made like so:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">spec</span>(d)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>cols(
  student_id = col_double(),
  classroom_id = col_double(),
  treatment = col_character(),
  reading_comprehension = col_double()
)</code></pre>
</div>
</div>
<p>The console output of this function is nice because we can copy, paste, and modify it to just what we want.</p>
<p>The <code>read_csv</code> function looks at the first few thousand cases of each variable and guesses what kind of variable it is: numeric (integers or decimals), character (text), logical (TRUE/FALSE), or factors. A factor in R is a nominal or ordinal variable.</p>
<p>The <code>student_id</code> variable uses numbers (<code>col_double</code> means <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format"><em>double-precision floating-point decimal format</em></a>) to uniquely identify the students. Thus, it is not a quantity, but an identifier. In the same way, social security numbers and telephone numbers are identifiers, not quantities. Because <code>student_id</code> is just a sequence of integers, the <code>read_csv</code> will by default assume it is a numeric variable. We would like to override the default and specify it to be a factor (R’s term for categorical data). Likewise, the <code>classroom_id</code> variable would be an integer, but we want it to be a factor.</p>
<p>The <code>treatment</code> variable is imported as text, but we would like it to be an ordered factor with “Control” listed first and “Treatment” listed second. In this case, “Control” and “Treatment” are already in alphabetical order, but it is a good idea to set the order you want explicitly. An additional benefit of doing so is that your code will document what it expects to find.</p>
<p>Next I re-import the data according to more precise specifications. This might seem like a lot of extra work. It is. However, being clear and explicit about your variables’ format usually saves you time and prevents tedium and heartache at later stages of your analysis.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://github.com/wjschne/EDUC5529/raw/master/random_intercept.csv"</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">student_id =</span> <span class="fu">col_factor</span>(),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">classroom_id =</span> <span class="fu">col_factor</span>(),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">treatment =</span> <span class="fu">col_factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Treatment"</span>)),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">reading_comprehension =</span> <span class="fu">col_double</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">classroom_id =</span> <span class="fu">fct_reorder</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> classroom_id, </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.x =</span> reading_comprehension, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fun =</span> mean))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>There is no inherent order to the <code>classroom_id</code>, so we can re-order it in any convenient fashion. Here I use the <code>mutate</code> function to update the <code>classroom_id</code> variable. I re-order it with the <code>fct_reorder</code> function, which re-orders according to each classroom’s mean on the <code>reading_comprhension</code> variable. That is, we want the low-scoring classrooms first and the high-scoring classrooms last.</p>
<p>To view the first few rows of the data:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  student_id classroom_id treatment reading_comprehension
  &lt;fct&gt;      &lt;fct&gt;        &lt;fct&gt;                     &lt;dbl&gt;
1 1          1            Treatment                 89.6 
2 1          2            Treatment                105.  
3 1          3            Control                    7.42
4 1          4            Treatment                 60.7 
5 1          5            Control                   35.4 
6 1          6            Control                   35.6 </code></pre>
</div>
</div>
</section>
<section id="model-0-random-intercepts" class="level1">
<h1>Model 0: Random Intercepts</h1>
<p>We are going to run a model in which there are no predictors at all, other than that each classroom has its own mean:</p>
<p><span class="math display">\begin{align*}
\mathbf{\text{Level 1:}}\\
Reading_{ij}&amp;=\beta_{0j}+e_{ij}\\[1.5ex]
\mathbf{\text{Level 2:}}\\
\beta_{0j}&amp;=\gamma_{00}+u_{0j}\\[1.5ex]
\mathbf{\text{Combined:}}\\
Reading_{ij}&amp;=\underbrace{\gamma_{00}+u_{0j}}_{\beta_{0j}}+e_{ij}\\
u_{0j} &amp;\sim N(0,\tau_{00})\\
e_{ij} &amp;\sim N(0,\sigma_e^2)
\end{align*}</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\beta_{0j}</span> is the random intercept for classroom <span class="math inline">j</span></li>
<li><span class="math inline">\gamma_{00}</span> is the overall fixed intercept</li>
<li><span class="math inline">u_{0j}</span> is the level 2 cluster random variable for classroom <span class="math inline">j</span></li>
<li><span class="math inline">e_{ij}</span> is the random level 1 individual random variable for student <span class="math inline">i</span> in classroom <span class="math inline">j</span>. It is the individual’s deviation from the classroom mean.</li>
<li><span class="math inline">\tau_{00}</span> is the variance of <span class="math inline">u_{0j}</span>. It is each classroom mean’s deviation from the overall mean <span class="math inline">\gamma_{00}</span>.</li>
<li><span class="math inline">\sigma_e^2</span> is the variance of <span class="math inline">e_{ij}</span>.</li>
</ul>
<p>Why run a model with no predictors? We need a baseline model–a null hypothesis against which to run other models.</p>
<section id="lme4-formula-syntax" class="level2">
<h2 class="anchored" data-anchor-id="lme4-formula-syntax">lme4 Formula Syntax</h2>
<p>The <code>lmer</code> function from the lme4 package is our primary tool for estimating multilevel models. The same syntax for OLS regression applies to lmer formulas, with one addition.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="model_formula_0.svg" class="img-fluid figure-img"></p>
<figcaption>lme4 syntax for a random intercepts model</figcaption>
</figure>
</div>
<ul>
<li>The variable on the left is the outcome variable, <code>reading_comprehension</code>.</li>
<li>The <code>~</code> means “predicted by.”</li>
<li>The first <code>1</code> is the overall intercept. In this model it represents the weighted mean of all the classrooms on the outcome variable (<code>reading_comprehension</code>).</li>
<li>The parentheses are for specifying a random variable.</li>
<li>The <code>1</code> inside the parentheses represents the random intercepts for each classroom.</li>
<li>The <code>|</code> means “nested in.”</li>
</ul>
</section>
<section id="model-fit-object" class="level2">
<h2 class="anchored" data-anchor-id="model-fit-object">Model Fit Object</h2>
<p>You can assign the model’s fit object to a variable. I am calling mine <code>m_0</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>m_0 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(reading_comprehension <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom_id), <span class="at">data =</span> d)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Thus far nothing appears to have happened. However, the <code>m_0</code> variable contains all the information we need to evaluate the model.</p>
</section>
<section id="checking-model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="checking-model-assumptions">Checking Model Assumptions</h2>
<p>The performance package has a nice, overall check:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="random_intercepts_files/figure-html/checkmodel-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Everything looks good. If we want, we can check things one at a time.</p>
<section id="normality-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="normality-assumptions">Normality Assumptions</h3>
<p>We want the level 1 and level 2 residuals to be normal. Here we check the level 1 residuals:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>norm_check <span class="ot">&lt;-</span> <span class="fu">check_normality</span>(m_0)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>norm_check</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: residuals appear as normally distributed (p = 0.663).</code></pre>
</div>
</div>
<p>The output says that the residuals are approximately normal. If the output says that the residuals are not normal, it might not be a major concern. Small departures from normality can trigger a significant test result. In general, we worry about large departures from normality, not statistically significant small ones. They best way to detect large departures from normality is to plot the residuals.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(norm_check)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-qqplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-qqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-qqplot-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-qqplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Checking the normality assumption with a Q-Q plot
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-qqplot" class="quarto-xref">Figure&nbsp;1</a> is called a Q-Q plot (Quantile-Quantile plot), which plots the standard normal distribution against the observed residuals. If the residuals are perfectly normal, the dots will be on a diagonal line. If a few points are outside the confidence interval in gray, there probably is nothing to worry about. However, if the points are not even close to the line or the gray confidence region, then maybe you need a generalized linear mixed model (<code>lme4::glmer</code>) instead of the linear mixed model (<code>lme4:lmer</code>). More on that later in the course.</p>
<p>The Level 1 residuals look approximately normal in <a href="#fig-qqplot" class="quarto-xref">Figure&nbsp;1</a>.</p>
<p>We can also check the normality of the level-2 residuals.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>norm_check_level2 <span class="ot">&lt;-</span> <span class="fu">check_normality</span>(m_0, <span class="at">effects =</span> <span class="st">"random"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>norm_check_level2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: Random effects 'classroom_id: (Intercept)' appear as normally distributed (p = 0.342).</code></pre>
</div>
</div>
<p><a href="#fig-norm2" class="quarto-xref">Figure&nbsp;2</a> suggests that the level-2 random effects are approximately normal. If the error bars did not straddle the regression line, then we would start to worry about the plausibility of the normality assumption at level 2.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(norm_check_level2)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-norm2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-norm2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-norm2-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-norm2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The Q-Q plot of the level-2 random effects
</figcaption>
</figure>
</div>
</div>
</div>
<p>The performance package has an admittedly experimental function that uses machine learning to predict the distribution of your residuals and response variable (i.e., <em>Y</em>, the variable you are predicting):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_distribution</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Distribution of Model Family

Predicted Distribution of Residuals

 Distribution Probability
       cauchy         75%
       normal         19%
  exponential          3%

Predicted Distribution of Response

 Distribution Probability
       normal         44%
       cauchy         41%
    lognormal          6%</code></pre>
</div>
</div>
<p><a href="#fig-checkdistribution" class="quarto-xref">Figure&nbsp;3</a> plots these estimates along with showing plots of the two residual distributions.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_distribution</span>(m_0))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-checkdistribution" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%" height="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-checkdistribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-checkdistribution-1.png" id="fig-checkdistribution" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-checkdistribution-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
</div>
</div>
<p>This function will become useful when we look at generalized linear mixed models and need to select a distribution family for our residuals.</p>
</section>
<section id="check-for-auto-correlation" class="level3">
<h3 class="anchored" data-anchor-id="check-for-auto-correlation">Check for auto-correlation</h3>
<p>If your data were gathered independently, the order of the cases should show no discernible trends. If adjacent cases are more similar to each other than to non-adjacent cases, then you have auto-correlation in your data. That might be a sign that the independence assumption has been violated.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_autocorrelation</span>(m_0) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: Residuals appear to be independent and not autocorrelated (p = 0.242).</code></pre>
</div>
</div>
<p>Fortunately, there is no evidence of autocorrelation here.</p>
</section>
<section id="check-for-non-constant-error-variance-heteroscedasticity" class="level3">
<h3 class="anchored" data-anchor-id="check-for-non-constant-error-variance-heteroscedasticity">Check for non-constant error variance (heteroscedasticity)</h3>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_heteroscedasticity</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Warning: Heteroscedasticity (non-constant error variance) detected (p &lt; .001).</code></pre>
</div>
</div>
<p>There is some of evidence of non-constant error variance. By itself, the warning that heteroscedasticity has been detected is not a big deal. In a large sample, statistically significant results sometimes can be triggered by trivially small departures from homoscedasticity. A plot can help us decide if this violation is worrisome.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_heteroscedasticity</span>(m_0))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-checkhetero" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-checkhetero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-checkhetero-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-checkhetero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Checking the homoscedasticity assumption
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-checkhetero" class="quarto-xref">Figure&nbsp;4</a> shows a mostly flat line. If you see major departures from a flat line, we might need to worry about why the residuals have larger variances for some predicted values than for others. This plot suggests that there is little to worry about.</p>
</section>
<section id="check-for-outliers" class="level3">
<h3 class="anchored" data-anchor-id="check-for-outliers">Check for outliers</h3>
<p>When the sample size is small, outliers can distort your findings.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_outliers</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>OK: No outliers detected.
- Based on the following method and threshold: cook (0.5).
- For variable: (Whole model)</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking for outliers</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">check_outliers</span>(m_0))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-checkoutlier" class="quarto-float quarto-figure quarto-figure-center anchored" width="100%" height="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-checkoutlier-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-checkoutlier-1.png" id="fig-checkoutlier" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-checkoutlier-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</div>
</div>
<p>This plot looks squished because none of the points have extreme leverage. Observations with high leverage are not necessarily bad. What we do not want to see is the combination of extreme residuals with extreme leverage.</p>
<p>An extreme residual is, by definition, far from the regression line. An observation with extreme leverage, by definition, is an outlier in terms of the predictor variables (i.e., in multiple regression, it is a multivariate outlier in the <em>predictor space</em>).</p>
<p>In the plot below, the blue line is the estimated regression line before the red outlier is added. The red line hows how the estimated regression line changes in the presence of the red outlier point.</p>
<p><img src="leverage.gif" class="img-fluid" alt="A point with high leverage and a large residual can cause large changes in the regession coefficients.">{fig-leverageplot}</p>
<p>Outliers in the predictor space are said to have <em>leverage</em> (the ability to influence coefficients). Notice that the red point barely changes the regression line when the predictor is near the mean of the predictor variable (i.e., when it has little leverage). When the red point is at either extreme of the predictor distribution, it has a lot of leverage to change the regression line. If the red point is near the original regression line, there is no harm done. However, if the red point has the combination of high leverage and a large residual (i.e., it is an outlier in terms of the predictors and also in terms of the residuals), the red regression line can become quite misleading.</p>
</section>
</section>
<section id="model-summary" class="level2">
<h2 class="anchored" data-anchor-id="model-summary">Model Summary</h2>
<p>As with OLS (ordinary least squares) models generated with the <code>lm</code> function, we can see the overall results with the <code>summary</code> function.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: reading_comprehension ~ 1 + (1 | classroom_id)
   Data: d

REML criterion at convergence: 8078

Scaled residuals: 
   Min     1Q Median     3Q    Max 
-3.613 -0.676  0.037  0.651  2.971 

Random effects:
 Groups       Name        Variance Std.Dev.
 classroom_id (Intercept) 304      17.4    
 Residual                 420      20.5    
Number of obs: 900, groups:  classroom_id, 30

Fixed effects:
            Estimate Std. Error t value
(Intercept)    57.04       3.25    17.5</code></pre>
</div>
</div>
<p>Here we are given the method by which the parameters were estimated: REML (Restricted Maximum Likelihood). We are told the range and interquartile range of the residuals. We are told the variance and SD of the random effects. We are given the estimates, standard errors, and <span class="math inline">t</span> statistics for the fixed variables, though in this case the only fixed effect is the overall intercept.</p>
</section>
<section id="model-statistics" class="level2">
<h2 class="anchored" data-anchor-id="model-statistics">Model Statistics</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">performance</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Indices of model performance

AIC      |     AICc |      BIC | R2 (cond.) | R2 (marg.) |   ICC |   RMSE |  Sigma
----------------------------------------------------------------------------------
8084.290 | 8084.317 | 8098.697 |      0.420 |      0.000 | 0.420 | 20.159 | 20.488</code></pre>
</div>
</div>
<p>Here we see the <code>Sigma</code>, the individual-level variance. The root-mean squared error is also a measure of individual-level variance but does not correct for degrees of freedom. The <code>AIC</code> and <code>BIC</code> statistics are useful for comparing models that are non-nested (i.e., models that differ in ways other than merely adding predictors). The R2 (cond.) is the variance explained by all terms, including random effects. The R2 (marg.) is the variance explained by the fixed effect effects. Because there are no fixed effects, this statistic is 0. ICC is the proportion of variance explained by the random effects, which in this case is equal to the R2 (cond.)</p>
<p>The report package has an automated interpretation function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>We fitted a constant (intercept-only) linear mixed model (estimated using REML
and nloptwrap optimizer) to predict reading_comprehension (formula:
reading_comprehension ~ 1). The model included classroom_id as random effect
(formula: ~1 | classroom_id). The model's intercept is at 57.04 (95% CI [50.66,
63.43], t(897) = 17.53, p &lt; .001).

Standardized parameters were obtained by fitting the model on a standardized
version of the dataset. 95% Confidence Intervals (CIs) and p-values were
computed using a Wald t-distribution approximation.</code></pre>
</div>
</div>
<p>If you do not want the entire report, it can be broken down into several components:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_info</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Standardized parameters were obtained by fitting the model on a standardized version of the dataset. 95% Confidence Intervals (CIs) and p-values were computed using a Wald t-distribution approximation.</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_model</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>constant (intercept-only) linear mixed model (estimated using REML and nloptwrap optimizer) to predict reading_comprehension (formula: reading_comprehension ~ 1). The model included classroom_id as random effect (formula: ~1 | classroom_id)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_effectsize</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Effect sizes were labelled following Cohen's (1988) recommendations. 

very small (Std. beta = 1.27e-15, 95% CI [-0.24, 0.24])</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_random</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>The model included classroom_id as random effect (formula: ~1 | classroom_id)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_intercept</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>The model's intercept is at 57.04 (95% CI [50.66, 63.43], t(897) = 17.53, p &lt; .001).</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_parameters</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - The intercept is statistically significant and positive (beta = 57.04, 95% CI [50.66, 63.43], t(897) = 17.53, p &lt; .001; Std. beta = 1.27e-15, 95% CI [-0.24, 0.24])</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">report_statistics</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>beta = 57.04, 95% CI [50.66, 63.43], t(897) = 17.53, p &lt; .001; Std. beta = 1.27e-15, 95% CI [-0.24, 0.24]</code></pre>
</div>
</div>
</section>
<section id="intraclass-correlation-coefficient-icc" class="level2">
<h2 class="anchored" data-anchor-id="intraclass-correlation-coefficient-icc">Intraclass Correlation Coefficient (ICC)</h2>
<p>If there is little variability in the level-2 intercepts, then a multilevel model might not be all that important. The intraclass correlation coefficient estimates how much variability in the outcome variable is explained by the level-2 intercepts:</p>
<p><span class="math display">\text{ICC}=\frac{\tau_{00}}{\tau_{00}+\sigma^2} = \frac{\text{Level 2 Residual Variance}}{\text{Level 2 + Level 1 Residual Variance}}</span></p>
<p>The performance package extracts the intraclass correlation coefficient.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">icc</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Intraclass Correlation Coefficient

    Adjusted ICC: 0.420
  Unadjusted ICC: 0.420</code></pre>
</div>
</div>
<p>The <strong>ICC</strong> here means that letting each classroom have its own mean explained 42% of the residual variance. Had the value</p>
<p>The regular ICC (“adjusted”) takes into account all random effects. The unadjusted ICC takes both fixed and random effects into account. Because there are no fixed effects in this model, the adjusted and conditional ICC are the same.</p>
<p><span class="math display">\text{ICC}_{\text{Unadjusted}}=\frac{\tau_{00}}{\tau_{00}+\sigma_e^2+\sigma_{\text{Fixed}}^2} = \frac{\text{Level 2 Residual Variance}}{\text{Total Variance}}</span></p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 88%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ICC</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Adjusted</td>
<td style="text-align: left;">The proportion of random variance explained by the grouping structure.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unadjusted</td>
<td style="text-align: left;">The proportion of all variance (fixed and random) explained by the grouping structure.</td>
</tr>
</tbody>
</table>
<p>The performance package also gives us an alternate set of model statistics along with the ICC.</p>
</section>
<section id="variance-explained-r2" class="level2">
<h2 class="anchored" data-anchor-id="variance-explained-r2">Variance Explained (<em>R<sup>2</sup></em>)</h2>
<p>The variance explained by a model is one of the ways we evaluate its explanatory scope.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Mixed Models

  Conditional R2: 0.420
     Marginal R2: 0.000</code></pre>
</div>
</div>
<p>The Conditional <em>R</em><sup>2</sup> is the variance explained by both the fixed and random variables. Note that in this model, because <span class="math inline">\sigma_{\text{fixed}}^2=0</span>, <span class="math inline">\text{R}_{\text{Conditional}}^2=\text{ICC}</span>.</p>
<p><span class="math display">\text{R}_{\text{Conditional}}^2=\frac{\tau_{00}+\sigma_{\text{Fixed}}^2}{\tau_{00}+\sigma_e^2+\sigma_{\text{Fixed}}^2} = \frac{\text{Level 2 Residual Variance + Fixed Variance}}{\text{Total Variance}}</span></p>
<p>The Marginal <em>R</em><sup>2</sup> is the variance explained by just the fixed variables. In this case, there are no fixed variables. Thus, Marginal <em>R</em><sup>2</sup> = 0.</p>
<p><span class="math display">\text{R}_{\text{Marginal}}^2=\frac{\sigma_{\text{Fixed}}^2}{\tau_{00}+\sigma_e^2+\sigma_{\text{Fixed}}^2} = \frac{\text{Fixed Variance}}{\text{Total Variance}}</span></p>
</section>
<section id="fixed-and-random-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="fixed-and-random-coefficients">Fixed and Random Coefficients</h2>
<p>Coefficient-level statistics can be viewed with the <code>parameters</code> function.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter   | Coefficient |   SE |         95% CI | t(897) |      p
-------------------------------------------------------------------
(Intercept) |       57.04 | 3.25 | [50.66, 63.43] |  17.53 | &lt; .001

# Random Effects

Parameter                    | Coefficient
------------------------------------------
SD (Intercept: classroom_id) |       17.42
SD (Residual)                |       20.49</code></pre>
</div>
</div>
<p>The only fixed coefficient is the overall intercept, which is not usually of theoretical interest.</p>
<p>If you only want fixed effect printed:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(m_0, <span class="at">effects =</span> <span class="st">"fixed"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter   | Coefficient |   SE |         95% CI | t(897) |      p
-------------------------------------------------------------------
(Intercept) |       57.04 | 3.25 | [50.66, 63.43] |  17.53 | &lt; .001</code></pre>
</div>
</div>
<p>If you only want random effect printed:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(m_0, <span class="at">effects =</span> <span class="st">"random"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Random Effects

Parameter                    | Coefficient | 95% CI
---------------------------------------------------
SD (Intercept: classroom_id) |       17.42 |       
SD (Residual)                |       20.49 |       </code></pre>
</div>
</div>
<p>The random parameters are standard deviations. Squaring the estimate for <code>sd__(Intercept)</code> will give <span class="math inline">\tau_{00}</span>. Squaring the estimate for <code>sd__Observation</code> will give <span class="math inline">\sigma^2</span>.</p>
<p>If you want estimated parameters for each group:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(m_0, <span class="at">effects =</span> <span class="st">"random"</span>, <span class="at">group_level =</span> <span class="cn">TRUE</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Random Effects

Parameter        | Coefficient |   SE |           95% CI
--------------------------------------------------------
(Intercept) [11] |      -28.30 | 3.66 | [-35.46, -21.13]
(Intercept) [26] |      -25.27 | 3.66 | [-32.44, -18.11]
(Intercept) [7]  |      -23.33 | 3.66 | [-30.50, -16.17]
(Intercept) [13] |      -22.16 | 3.66 | [-29.32, -14.99]
(Intercept) [21] |      -21.82 | 3.66 | [-28.99, -14.65]
(Intercept) [3]  |      -21.29 | 3.66 | [-28.46, -14.12]
(Intercept) [15] |      -13.16 | 3.66 | [-20.33,  -5.99]
(Intercept) [23] |      -11.85 | 3.66 | [-19.02,  -4.69]
(Intercept) [29] |       -9.81 | 3.66 | [-16.98,  -2.64]
(Intercept) [30] |       -8.60 | 3.66 | [-15.77,  -1.43]
(Intercept) [5]  |       -7.86 | 3.66 | [-15.02,  -0.69]
(Intercept) [9]  |       -7.08 | 3.66 | [-14.24,   0.09]
(Intercept) [28] |       -6.95 | 3.66 | [-14.12,   0.22]
(Intercept) [6]  |       -5.40 | 3.66 | [-12.57,   1.77]
(Intercept) [27] |       -3.05 | 3.66 | [-10.22,   4.12]
(Intercept) [12] |        1.61 | 3.66 | [ -5.56,   8.78]
(Intercept) [18] |        1.83 | 3.66 | [ -5.34,   9.00]
(Intercept) [17] |        4.50 | 3.66 | [ -2.66,  11.67]
(Intercept) [10] |        7.02 | 3.66 | [ -0.14,  14.19]
(Intercept) [4]  |        7.55 | 3.66 | [  0.38,  14.72]
(Intercept) [24] |        8.07 | 3.66 | [  0.91,  15.24]
(Intercept) [14] |       10.14 | 3.66 | [  2.97,  17.30]
(Intercept) [25] |       17.51 | 3.66 | [ 10.34,  24.68]
(Intercept) [8]  |       17.86 | 3.66 | [ 10.69,  25.03]
(Intercept) [16] |       18.11 | 3.66 | [ 10.94,  25.28]
(Intercept) [20] |       18.43 | 3.66 | [ 11.26,  25.60]
(Intercept) [19] |       21.06 | 3.66 | [ 13.89,  28.22]
(Intercept) [22] |       23.32 | 3.66 | [ 16.15,  30.49]
(Intercept) [1]  |       27.11 | 3.66 | [ 19.94,  34.28]
(Intercept) [2]  |       31.81 | 3.66 | [ 24.64,  38.98]</code></pre>
</div>
</div>
<p>Why would you want the estimated values? Maybe you want to make a plot of the random intercepts like in <a href="#fig-plotgroupcoef" class="quarto-xref">Figure&nbsp;6</a>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(m_0, <span class="at">effects =</span> <span class="st">"random"</span>, <span class="at">group_level =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Level =</span> <span class="fu">fct_inorder</span>(Level)) <span class="sc">%&gt;%</span>  <span class="co"># Reorder classroom id</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Level, Coefficient)) <span class="sc">+</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> CI_low,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> CI_high )) <span class="sc">+</span> </span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Classroom ID"</span>, </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Random Intercepts"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-plotgroupcoef" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plotgroupcoef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-plotgroupcoef-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plotgroupcoef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Group coefficients
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="basic-plot" class="level2">
<h2 class="anchored" data-anchor-id="basic-plot">Basic Plot</h2>
<p>Suppose we want the predicted value for each classroom. There are a variety of ways to do this. We are going to get case-level predictions from the marginaleffects package’s <code>predictions</code> function. A nice feature of his function is that it will average the predictions over any variable. In this case, the prediction is the same for all 30 groups, so instead of 900 predictions (one for each person), we only need 30 predictions (one for each classroom).</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>d_predicted <span class="ot">&lt;-</span> marginaleffects<span class="sc">::</span><span class="fu">predictions</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  m_0, </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"classroom_id"</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot distributions and predicted values</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> classroom_id,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> reading_comprehension)) <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d_predicted,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">get_intercept</span>(m_0)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="random_intercepts_files/figure-html/m0plot-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Here a fancier version of the same plot.</p>
<div class="cell preview-image">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggtext displays rich text</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> classroom_id,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> reading_comprehension)) <span class="sc">+</span> </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Within-group variability</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="cn">NA</span>, <span class="at">scale =</span> <span class="st">"width"</span>, <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display raw data</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  ggbeeswarm<span class="sc">::</span><span class="fu">geom_quasirandom</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">pch =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group means as horizontal segments</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d_predicted,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">as.numeric</span>(classroom_id) <span class="sc">-</span> <span class="fl">0.5</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">xend =</span> <span class="fu">as.numeric</span>(classroom_id) <span class="sc">+</span> <span class="fl">0.5</span>,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> estimate ,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">yend =</span> estimate ),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">linewidth =</span>  .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group means as text</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> estimate, </span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">number</span>(estimate,.<span class="dv">1</span>)), </span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d_predicted,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> tinter<span class="sc">::</span><span class="fu">lighten</span>(<span class="st">'dodgerblue'</span>, .<span class="dv">25</span>),</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, </span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.8</span>, </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray30"</span>, </span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"mm"</span>), <span class="at">label.size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display Overall intercept coefficient as text</span></span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(<span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">classroom_id =</span> <span class="dv">1</span>,</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">reading_comprehension =</span> <span class="fu">get_intercept</span>(m_0),</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span>  glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"*&amp;gamma;*&lt;sub&gt;00&lt;/sub&gt; = {round(fixef(m_0), 2)}"</span>)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.margin =</span> <span class="fu">unit</span>(<span class="dv">1</span>,<span class="st">"mm"</span>),</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="dv">0</span>,<span class="st">"mm"</span>),</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.color =</span> <span class="cn">NA</span>,</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(<span class="st">"white"</span>, <span class="fl">0.5</span>), </span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">vjust =</span> <span class="dv">0</span>,</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="dv">0</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display Overall intercept as horizontal line</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">get_intercept</span>(m_0)) <span class="sc">+</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Axis labels</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Classrooms"</span>, <span class="at">y =</span> <span class="st">"Reading Comprehension"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-model0" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-model0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-model0-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-model0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Model 0 Group intercepts
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-1-effect-of-treatment" class="level1">
<h1>Model 1: Effect of Treatment</h1>
<div class="sidenote">
<p>Had students been individually assigned to treatment, in every class there would be treated and untreated students. In this case, <code>treatment</code> would be individually randomized and therefore would have been a Level-1 effect.</p>
</div>
<p>Now we add an effect of treatment to the model. This study has a “cluster-randomized” design, meaning that whole classes were randomly assigned to treatment groups. Thus, with this design, <code>treatment</code> is a Level-2 effect.</p>
<p><span class="math display">
\begin{align*}
\mathbf{\text{Level 1:}}\\
Reading_{ij}&amp;=\beta_{0j}+ e_{ij}\\[1.5ex]
\mathbf{\text{Level 2:}}\\
\beta_{0j}&amp;=\gamma_{00}+\gamma_{01} Treatment_{j}+u_{0j}\\[1.5ex]
\mathbf{\text{Combined:}}\\
Reading_{ij}&amp;=\gamma_{00}+\gamma_{01}Treatment_{j}+u_{0j}+e_{ij}\\
u_{0j} &amp;\sim N(0,\tau_{00})\\
e_{ij} &amp;\sim N(0,\sigma_e^2)
\end{align*}
</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">Reading_{ij}</span> is the reading comprehension score for person <span class="math inline">i</span> in classroom <span class="math inline">j</span>.</li>
<li><span class="math inline">\beta_{0j}</span> is the random intercept for classroom <span class="math inline">j</span>.</li>
<li><span class="math inline">e_{ij}</span> is the random level 1 individual random variable for student <span class="math inline">i</span> in classroom <span class="math inline">j</span>. It is each individual’s deviation from the classroom mean.</li>
<li><span class="math inline">\gamma_{00}</span> is the fixed intercept. In this model, it represents the predicted value of reading when Treatment = 0 (i.e., the control group).</li>
<li><span class="math inline">\gamma_{01}</span> is the treatment effect—the difference between the overall control group mean and the treatment group mean.</li>
<li><span class="math inline">Treatment_{j}</span> is value of treatment (Control = 0, Intervention = 1) for classroom <span class="math inline">j</span>.</li>
<li><span class="math inline">u_{0j}</span> is the level 2 cluster random variable for classroom <span class="math inline">j</span>. It is each classroom mean’s deviation from its respective treatment group mean.</li>
<li><span class="math inline">\tau_{00}</span> is the variance of <span class="math inline">u_{0j}</span>.</li>
<li><span class="math inline">\sigma_e^2</span> is the variance of <span class="math inline">e_{ij}</span>.</li>
</ul>
<section id="fit-object" class="level2">
<h2 class="anchored" data-anchor-id="fit-object">Fit object</h2>
<p>Representing the fixed intercept, the initial <code>1</code> is optional. I included it to be explicit, but most of the time it is omitted.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>m_1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(reading_comprehension <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> treatment <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> classroom_id), </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> d)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Sometimes these models can become large and unwieldy, making you vulnerable to coding errors. A safer way to create a nested model is to use the <code>update</code> function that only changes the part you specify. In this syntax, a <code>.</code> means that everything is the same.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>m_1 <span class="ot">&lt;-</span> <span class="fu">update</span>(m_0, . <span class="sc">~</span> . <span class="sc">+</span> treatment)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The formula above means “Make a new model based on the <code>m_0</code> model. On the left-hand side, the outcome variable is the same. On the right-hand side, everything is the same except that we want to add the <code>treatment</code> variable as a predictor. Also, use the same data.”</p>
<p>It is best practice to use the <code>update</code> function wherever possible, because it reduces errors by making you explicitly state which part of the model will change.</p>
</section>
<section id="assumption-checks" class="level2">
<h2 class="anchored" data-anchor-id="assumption-checks">Assumption Checks</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">check_model</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="random_intercepts_files/figure-html/m1checkmodel-1.png" style="width:100.0%;height:100.0%" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Still no problems.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: reading_comprehension ~ (1 | classroom_id) + treatment
   Data: d

REML criterion at convergence: 8053.1

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.5797 -0.6787  0.0420  0.6488  3.0029 

Random effects:
 Groups       Name        Variance Std.Dev.
 classroom_id (Intercept) 149.4    12.22   
 Residual                 419.8    20.49   
Number of obs: 900, groups:  classroom_id, 30

Fixed effects:
                   Estimate Std. Error t value
(Intercept)          45.416      3.196  14.212
treatmentTreatment   24.908      4.678   5.325

Correlation of Fixed Effects:
            (Intr)
trtmntTrtmn -0.683</code></pre>
</div>
</div>
<p>With a <em>t</em> value of 5.32, the effect of <code>treatment</code> is surely significant.</p>
<p>Note that <code>lmer</code> displays the <code>treatment</code> variable as <code>treatmentTreatment</code>. This means that it is how much the Treatment group differs from the reference group, which in this case the control group. R is not smart enough to know in advance that the control group is the reference group. Instead, it assumes that the first factor level listed is the reference group. In this case, the control group is listed first. If you want a different reference group, you need to change the order of the factor levels. The base R way is to use the <code>relevel</code> function, but see the <a href="https://forcats.tidyverse.org/">forcats package</a> for other useful ways to do this.</p>
<p>The report package has an automated interpretation function. Note that unlike the <code>summary</code> function, the <code>report</code> function includes <em>p</em>-values for the fixed effects.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall report</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">report</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>We fitted a linear mixed model (estimated using REML and nloptwrap optimizer)
to predict reading_comprehension with treatment (formula: reading_comprehension
~ treatment). The model included classroom_id as random effect (formula: ~1 |
classroom_id). The model's total explanatory power is substantial (conditional
R2 = 0.42) and the part related to the fixed effects alone (marginal R2) is of
0.21. The model's intercept, corresponding to treatment = Control, is at 45.42
(95% CI [39.14, 51.69], t(896) = 14.21, p &lt; .001). Within this model:

  - The effect of treatment [Treatment] is statistically significant and positive
(beta = 24.91, 95% CI [15.73, 34.09], t(896) = 5.32, p &lt; .001; Std. beta =
0.93, 95% CI [0.59, 1.28])

Standardized parameters were obtained by fitting the model on a standardized
version of the dataset. 95% Confidence Intervals (CIs) and p-values were
computed using a Wald t-distribution approximation.</code></pre>
</div>
</div>
</section>
<section id="plot-model" class="level2">
<h2 class="anchored" data-anchor-id="plot-model">Plot Model</h2>
<p>From <a href="#fig-plot2" class="quarto-xref">Figure&nbsp;8</a>, it is easy to see that the treatment group has higher reading comprehension, on average, than the control group.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>modelbased<span class="sc">::</span><span class="fu">estimate_relation</span>(m_1) <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>() <span class="sc">+</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Reading Comprehension"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-plot2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-plot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-plot2-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-plot2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Model-based estimate of the relationship between treatment and reading comprehension
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="fixed-and-random-coefficients-1" class="level2">
<h2 class="anchored" data-anchor-id="fixed-and-random-coefficients-1">Fixed and Random Coefficients</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter             | Coefficient |   SE |         95% CI | t(896) |      p
-----------------------------------------------------------------------------
(Intercept)           |       45.42 | 3.20 | [39.14, 51.69] |  14.21 | &lt; .001
treatment [Treatment] |       24.91 | 4.68 | [15.73, 34.09] |   5.32 | &lt; .001

# Random Effects

Parameter                    | Coefficient
------------------------------------------
SD (Intercept: classroom_id) |       12.22
SD (Residual)                |       20.49</code></pre>
</div>
</div>
<p>Here we see that the <code>treatment</code> variable’s estimate is statistically significant.</p>
<p>If we want to see what the estimated means are for the 2 treatment groups:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>modelbased<span class="sc">::</span><span class="fu">estimate_means</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Estimated Marginal Means

treatment |  Mean |   SE |         95% CI
-----------------------------------------
Control   | 45.42 | 3.20 | [38.87, 51.96]
Treatment | 70.32 | 3.42 | [63.33, 77.32]

Marginal means estimated at treatment</code></pre>
</div>
</div>
</section>
<section id="intraclass-correlation-coefficient" class="level2">
<h2 class="anchored" data-anchor-id="intraclass-correlation-coefficient">Intraclass Correlation Coefficient</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">icc</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Intraclass Correlation Coefficient

    Adjusted ICC: 0.262
  Unadjusted ICC: 0.206</code></pre>
</div>
</div>
<p>Compare these values to Model 0’s ICC</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">icc</span>(m_0)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Intraclass Correlation Coefficient

    Adjusted ICC: 0.420
  Unadjusted ICC: 0.420</code></pre>
</div>
</div>
<p>Here we see that the ICC’s are reduced—because treatment explained some of the between-group variability.</p>
</section>
<section id="variance-explained-r2-1" class="level2">
<h2 class="anchored" data-anchor-id="variance-explained-r2-1">Variance Explained (<em>R<sup>2</sup></em>)</h2>
<p>In OLS regression, the variance explained is fairly straightforward because there is only one random residual. Its size changes with each new predictor added to the model. With multilevel models, variance explained is more complicated because there are multiple residuals to worry about.</p>
<p>Our model consists of fixed effects (intercept and predictors) and random effects at level 1 and level 1:</p>
<p><span class="math display">
Reading_{ij}=\underbrace{\gamma_{00}+\gamma_{01}Treatment_{j}}_{\text{Fixed}}+\underbrace{u_{0j}}_{\text{Random}_2}+\underbrace{e_{ij}}_{\text{Random}_1}
</span></p>
<p>We can calculate the variance of the fixed effects, and the 2 random effects.</p>
<p><span class="math display">
\begin{align}
\sigma_{\text{Fixed}}^2&amp;=\text{Var}(\gamma_{00}+\gamma_{01}Treatment_{j})\\
\sigma_{1}^2&amp;=\text{Var}(e_{ij})=\sigma_e^2\\
\sigma_{2}^2&amp;=\text{Var}(u_{0j})=\tau_{00}
\end{align}
</span></p>
<p>The <em>marginal</em> <span class="math inline">R^2</span> is the ratio of the variance of the fixed effects and the total variance (fixed, level 1, and level 2). That is, what percentage of variance is explained by the fixed effects.</p>
<p><span class="math display">
R^2_{\text{Marginal}}=\frac{\sigma_{\text{Fixed}}^2}{\sigma_{\text{Fixed}}^2+\sigma_{2}^2+\sigma_{1}^2}
</span></p>
<p>The <em>conditional</em> <span class="math inline">R^2</span> compares the fixed and level 2 variances to the total variance (fixed, level 1, and level 2). In this context, what percentage of variance is explained by the fixed effects and the random intercepts.</p>
<p><span class="math display">
R^2_{\text{Conditional}}=\frac{\sigma_{\text{Fixed}}^2+\sigma_{2}^2}{\sigma_{\text{Fixed}}^2+\sigma_{2}^2+\sigma_{1}^2}
</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">r2</span>(m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># R2 for Mixed Models

  Conditional R2: 0.420
     Marginal R2: 0.214</code></pre>
</div>
</div>
<p>Here we see that Marginal <em>R<sup>2</sup></em> increased from 0 to 0.21, meaning that a substantial portion of the between-group variability is accounted for by <code>treatment</code>.</p>
<p>The Conditional <em>R<sup>2</sup></em> is the same as it was in model 0, because <code>treatment</code> cannot account for additional variability beyond <code>classroom_id</code> (which “accounts” for 100% of the between-group variability).</p>
</section>
<section id="compare-models" class="level2">
<h2 class="anchored" data-anchor-id="compare-models">Compare Models</h2>
<p>To compare model coefficients, use the <code>parameters::compare_models</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_models</span>(m_0, m_1, <span class="at">effects =</span> <span class="st">"all"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Fixed Effects

Parameter             |                  m_0 |                  m_1
-------------------------------------------------------------------
(Intercept)           | 57.04 (50.66, 63.43) | 45.42 (39.14, 51.69)
treatment [Treatment] |                      | 24.91 (15.73, 34.09)

# Random Effects

Parameter                    |   m_0 |   m_1
--------------------------------------------
SD (Intercept: classroom_id) | 17.42 | 12.22
SD (Residual)                | 20.49 | 20.49</code></pre>
</div>
</div>
<p>To test the whether one variable explains more variance than a different nested variable, use the <code>anova</code> function.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m_0, m_1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: d
Models:
m_0: reading_comprehension ~ 1 + (1 | classroom_id)
m_1: reading_comprehension ~ (1 | classroom_id) + treatment
    npar  AIC  BIC logLik deviance Chisq Df Pr(&gt;Chisq)    
m_0    3 8088 8103  -4041     8082                        
m_1    4 8069 8089  -4031     8061    21  1    4.6e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The <em>p</em>-value is in <code>Pr(&gt;Chisq)</code> column. It means that <code>m_1</code>’s deviance statistic is significantly smaller than that of <code>m_0</code>.</p>
<p>The performance function <code>compare_peformance</code> gives many metrics of change. The Akaike Information Criterion (AIC) and the Bayesian Information Criterion (BIC) can be used to compare non-nested models. The <code>AIC_wt</code> and <code>BIC_wt</code> columns tell you the conditional probabilities in favor of each model.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare_performance</span>(m_0, m_1) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># Comparison of Model Performance Indices

Name |   Model |  AIC (weights) | AICc (weights) |  BIC (weights) | R2 (cond.)
------------------------------------------------------------------------------
m_0  | lmerMod | 8088.5 (&lt;.001) | 8088.5 (&lt;.001) | 8102.9 (&lt;.001) |      0.420
m_1  | lmerMod | 8069.6 (&gt;.999) | 8069.6 (&gt;.999) | 8088.8 (0.999) |      0.420

Name | R2 (marg.) |   ICC |   RMSE |  Sigma
-------------------------------------------
m_0  |      0.000 | 0.420 | 20.159 | 20.488
m_1  |      0.214 | 0.262 | 20.172 | 20.488</code></pre>
</div>
</div>
<p>In this case, it is clear that model <code>m_1</code> is preferred compared to <code>m_0</code>.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_performance</span>(m_0, m_1) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Name |   Model |     BF
-----------------------
m_0  | lmerMod |       
m_1  | lmerMod | &gt; 1000
Models were detected as nested (in terms of fixed parameters) and are compared in sequential order.</code></pre>
</div>
</div>
<p>We can also compare the models with a Bayes Factor (<code>BF</code>). If <code>BF</code> &gt; 1, there is more evidence for the second model. If <code>BF</code> &lt; 1, there is greater evidence for the first model.</p>
<p>Here are some guidelines for interpreting <code>BF</code> Raftery (1995):</p>
<ul>
<li><em>bf</em> = 1–3: Weak</li>
<li><em>bf</em> = 3–20: Positive</li>
<li><em>bf</em> = 20–150: Strong</li>
<li><em>bf</em> &gt; 150: Very strong</li>
</ul>
<p>Raftery, A. E. (1995). Bayesian model selection in social research. <em>Sociological Methodology 25</em>, 111–64.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_bf</span>(m_0, m_1) <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">report</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bayes factors were computed using the BIC approximation, by which BF10 =
exp((BIC0 - BIC1)/2). Compared to the 1 + (1 | classroom_id) model, we found
extreme evidence (BF = 1.17e+03) in favour of the treatment + (1 |
classroom_id) model (the least supported model).</code></pre>
</div>
</div>
<p>Thus we see that there is strong evidence that <code>m_1</code> is a better model than <code>m_0</code>.</p>
</section>
<section id="reduction-in-random-variable-variance" class="level2">
<h2 class="anchored" data-anchor-id="reduction-in-random-variable-variance">Reduction in random variable variance</h2>
<p>Although the Model 0 <span class="math inline">\tau_{00}</span> has the same symbol as the Model 1 <span class="math inline">\tau_{00}</span>, they are not the same. I therefore will distinguish the Model 0 and Model1 <span class="math inline">\tau_{00}</span> with second-level subscripts: <span class="math inline">\tau_{00_0}</span> and <span class="math inline">\tau_{00_1}</span>, respectively.</p>
<p><span class="math display">\Delta R_2^2(\text{approx})=\frac{\tau_{00_0}-\tau_{00_1}}{\tau_{00_0}}</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>tau_00_0 <span class="ot">&lt;-</span> <span class="fu">get_variance_random</span>(m_0)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>tau_00_1 <span class="ot">&lt;-</span> <span class="fu">get_variance_random</span>(m_1)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>(tau_00_0 <span class="sc">-</span> tau_00_1) <span class="sc">/</span> tau_00_0</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>var.random 
    0.5077 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="dv">100</span><span class="sc">*</span><span class="fu">round</span>((tau_00_0 <span class="sc">-</span> tau_00_1) <span class="sc">/</span> tau_00_0, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>var.random 
      50.8 </code></pre>
</div>
</div>
<p>This means that <em>τ</em><sub>00/1</sub> = 149.41 is 50.8% smaller than <em>τ</em><sub>00/0</sub> = 303.51.</p>
<p>We can likewise see if there is any reduction in level-1 variance by comparing the residual variance of both models:</p>
<p><span class="math display">\Delta R_1^2(\text{approx})=\frac{\sigma_{0}^2-\sigma_{1}^2}{\sigma_{0}^2}</span></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>sigma_e_0 <span class="ot">&lt;-</span> <span class="fu">get_variance_residual</span>(m_0)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>sigma_e_1 <span class="ot">&lt;-</span> <span class="fu">get_variance_residual</span>(m_1)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>(sigma_e_0 <span class="sc">-</span> sigma_e_1) <span class="sc">/</span> sigma_e_0</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>var.residual 
    2.37e-09 </code></pre>
</div>
</div>
<p>You can see that the reduction is very close to 0. Why? Because treatment was cluster-randomized. As a level-2 variable, it would be hard to see how it could influence individual variability. That is, everyone in the same classroom has the same treatment. The level-1 residuals (<em>e<sub>ij</sub></em>) are created by subtracting from the classroom means. Thus, the <code>treatment</code> variable cannot distinguish between anyone in the same class and cannot explain any individual variability.</p>
<p>Later we will see that treatment might interact with an individual difference variable such that the treatment works for some students better than for others. In such a model, a level-2 predictor could influence individual variability.</p>
</section>
<section id="not-so-basic-plot" class="level2">
<h2 class="anchored" data-anchor-id="not-so-basic-plot">Not-So Basic Plot</h2>
<p><a href="#fig-notbasic" class="quarto-xref">Figure&nbsp;9</a> makes it quite clear that the treatment is associated with higher overall scores.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>d_augmented_1 <span class="ot">&lt;-</span> <span class="fu">augment</span>(m_1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get unique values of the fitted responses</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>d_classroom_1 <span class="ot">&lt;-</span> d_augmented_1 <span class="sc">%&gt;%</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(classroom_id, .fitted, treatment) <span class="sc">%&gt;%</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the mean values (.fixed) for each treatment condition</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>d_treatment_1 <span class="ot">&lt;-</span> d_augmented_1 <span class="sc">%&gt;%</span> </span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.fixed, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a><span class="co"># plot distributions and predicted values</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(m_1) <span class="sc">%&gt;%</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">fct_rev</span>(treatment)) <span class="sc">%&gt;%</span> </span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> classroom_id,</span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> reading_comprehension)) <span class="sc">+</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">color =</span> <span class="cn">NA</span>, </span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">fill =</span> treatment), </span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d_classroom_1,</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> .fitted)) <span class="sc">+</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> d_treatment_1, </span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> .fixed)) <span class="sc">+</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(treatment), </span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="fig-notbasic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-notbasic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="random_intercepts_files/figure-html/fig-notbasic-1.png" style="width:100.0%;height:100.0%" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-notbasic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Treatment effects for Model 1
</figcaption>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/wjschne\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>