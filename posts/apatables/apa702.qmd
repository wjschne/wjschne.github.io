---
title: Recreating APA Manual Table 7.2 in R with apa7
date: '2025-09-12'
engine: knitr
categories: 
  - R
  - APA Style
description: "Demonstration of the apa7 package, a flextable extension package"
tags:
  - APA Style
  - flextable
  - apa7
csl: _extensions/wjschne/apaquarto/apa.csl
format:
  html: 
    theme: [minty, "../../style/schneider.scss", "../../style/apablog.scss"]
    fig-cap-location: top
    citeproc: false
    link-external-icon: false
    link-external-newwindow: false
    toc: true
    toc-location: left
    anchor-sections: false
    html-math-method: katex
    knitr: 
      opts_chunk: 
        dev: svglite
    # code-annotations: hover
    filters:  
      - at: pre-ast
        path: _extensions/wjschne/apaquarto/crossrefprefix.lua
      - at: pre-ast
        path: _extensions/wjschne/apaquarto/apafigtblappendix.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/apacaption.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/apaextractfigure.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/apanote.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/apafloat.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/apafloat.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/citeprocr.lua
      - at: post-render
        path: _extensions/wjschne/apaquarto/apaandcite.lua
---

# Making tables in APA style (Part 2 of 24)

In this 24-part series, each of the tables in Chapter 7 of the *Publication Manual of the American Psychological Association* (7th Edition) is recreated with [apa7](https://wjschne.github.io/apa7/), [flextable](https://ardata-fr.github.io/flextable-book/), [easystats](https://easystats.github.io/easystats/), and [tidyverse](https://www.tidyverse.org/packages/) functions.

:::{.callout-note}
# Highlights

* Hanging indents with the `hanging_indent`
* Conditional indentation with `padding`
* Decimal alignment with `align_chr`
:::

```{r}
#| label: setup
#| include: false
library(apa7)
library(flextable)
library(ftExtra)
library(tidyverse)
set_flextable_defaults(theme_fun = theme_apa, 
                       font.family = "Times New Roman")

```

```{r postsetup, eval=FALSE}
<<setup>>
```
@fig-72 Shows some demographic summary data. Getting the data into the proper shape took a fair amount of code, but such data wrangling is not the point of this tutorial. The part that was tricky was getting the text wrapping and hanging indentation right. 

![Screenshot of the *APA Manual*'s Table 7.1](table72.png){#fig-72 width="100%"}

## Hanging Indentation

Indentation is usually easy with flextable's [`padding`](https://davidgohel.github.io/flextable/reference/padding.html) function. Here, some columns needed indentation, some hanging indentation, and some needed both. The best solution I found was to seize control of the formatting using [`stringr::str_wrap`](https://stringr.tidyverse.org/reference/str_wrap.html) to find where to break the lines and then markdown (`\\` to make new lines, and `\u00A0`, the figure space, to indent). The [`hanging_indent`](https://wjschne.github.io/apa7/reference/hanging_indent.html) function implements these steps automatically.

## Decimal Alignment

To my eye, numeric text often looks better when decimal aligned. The [`align_chr`](https://wjschne.github.io/apa7/reference/align_chr.html) function allows text to be centered within a column and yet still aligned on the decimal (or any other character). By default, it pads the numeric vector with the figure space (`&numsp;` or `\u2007`) character, which is as wide as an integer.

Does flextable already have decimal alignment? [Yes](https://github.com/davidgohel/flextable/issues/549#issuecomment-1961765244)! However, its method requires the user to supply the position of a decimal tab within the column, which may require a fair bit of trial and error. Of course, if you need decimal alignment somewhere other than in the center of a column, the flextable method is the best option. 

## Turn off automatic formatting

By default, [`apa_flextable`](https://wjschne.github.io/apa7/reference/apa_flextable.html) will automatically format columns with specific names (or endings). The `Variable` column is one of those, and by default, it will transform the text to title case. In this instance, we want sentence casing, so we list `Variable` in `no_format_columns`. 

The remaining columns that normally get automatic formatting (i.e, columns ending with "_n") will still get it. Setting `auto_format_columns = FALSE`, will turn off all automatic formatting. 

```{r}
#| label: tbl-72
#| tbl-cap: Sociodemographic Characteristics of Participants at Baseline
#| apa-note: 
#|   - "*N*&nbsp;=&nbsp;150 (*n*&nbsp;=&nbsp;50 for each condition). Participants 
#|      were on average 39.5 years old (SD&nbsp;=&nbsp;10.1), and 
#|      participant age did not differ by condition."
#|   - "^a\u00A0^Reflects the number and percentage of
#|      participants answering “yes” to this question."
#| echo: fenced

# Make data
d <- tibble(
  Variable = c(
    rep("Gender", 2),
    rep("Marital status",4), 
    rep("Children",2),
    rep("Cohabiting", 2),
    rep("Highest educational level", 3),
    rep("Employment", 5),
    rep("Previous\u00A0psychological treatment",2),
    rep("Previous\u00A0psychotropic medication",2)
    ),
  Group = c(
    "Female","Male","Single","Married/partnered",
    "Divorced/widowed","Other", 
    "Yes","No",
    "Yes","No",
    "Middle school", "High school/some college",
    "University or post-graduate degree",
    "Unemployed","Student","Employed",
    "Self-employed","Retired","Yes","No","Yes","No"),
    `Guided self-help` = c(
      25L, 25L, 13L, 35L, 1L, 1L, 26L, 24L, 37L, 13L,
      0L, 22L, 27L, 3L, 8L, 30L, 9L, 0L, 17L, 33L, 6L, 44L),
  `Unguided self-help` = c(
    20L, 30L, 11L, 38L, 1L, 0L, 26L, 24L, 36L, 14L, 1L,
    17L, 30L, 5L, 7L, 29L, 7L, 2L, 18L, 32L, 13L, 37L),
   `Wait-list control` = c(
     23L, 27L, 17L, 28L, 4L, 1L, 22L, 28L, 26L, 24L, 
     1L, 13L, 32L, 2L, 3L, 40L, 5L, 0L, 24L, 26L, 11L, 39L)
) 

# format data
d_formatted <- d |> 
  pivot_longer(-c(Variable, Group), 
               values_to = "n") |>
  mutate(`%` = round(100  * n / sum(n)), 
         .by = c(Variable, name)) |>
  mutate(`Full sample_n` = sum(n),
         .by = c(Variable, Group)) |>
  pivot_wider_name_first(values_from = c(n , `%`)) |> 
  relocate(`Full sample_n`, .after = last_col()) |>
  mutate(
    `Full sample_%` = 100 * `Full sample_n` /
      sum(`Full sample_n`),
    .by = c(Variable)
  ) |>
  filter(Group !=  "No") |>
  mutate(Group = ifelse(
    Group == "Yes", 
    paste0(Variable, "^a^"), Group) |>
      hanging_indent(width = 22)) |>
  rename(`Baseline\ncharacteristic` = Group) |> 
  mutate(across(c(ends_with("_\\*n\\*"), 
                  ends_with("_%")), 
                .fns = \(x) align_chr(x, accuracy = .1)))

# Make table
d_formatted |> 
  apa_flextable(
    row_title_column = Variable,
    row_title_border = NA,
    line_spacing = 1.5, 
    horizontal_padding = 0,
    font_size = 10.5,
    left_column_padding = 10, 
    no_format_columns = Variable) |>
  align(j = 1, align = "left") |>
  width(width = c(1.55, rep(c(.6, .6, .05), 4)[-12]))
```

Because I used `apa-note` instead of flextable functions, the notes would only appear if using the apaquarto extension.
